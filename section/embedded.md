## Generating embedded triples with RML-star {#embedded}

A <dfn>star map</dfn> (`rml:StarMap`) is a [term map](https://rml.io/specs/rml/#term-map) that generates [=embedded triples=].
It can be used in the subject map and object map positions.
A star map has exactly one [triples map](https://rml.io/specs/rml/#triples-map) it is linked to by the <dfn>embedded triples map</dfn> property (`rml:embeddedTriplesMap`). 
The [=embedded triples=] generated by a [=star map=] are exactly those triples generated by its [=embedded triples map=].
If a star map has the same [logical source](https://rml.io/specs/rml/#logical-source) as its [=embedded triples map=] then for each [logical iteration](https://rml.io/specs/rml/#iterator) the [=embedded triples=] generated by a star map are those triples generated by its [=embedded triples map=] *for the same logical iteration*.
If a star map has a different logical source than its embedded triples map then a join is used, as described in [the next section](#join).

In the following example, per logical iteration, i.e., per CSV row, a "type" triple is generated by `:innerTriplesMap` that occurs 
in the resulting graph both as an asserted and as an embedded triple: 

<pre class="ex-input">
entity,class,confidence
Alice,Person,0.8
Bobby,Dog,0.6
</pre>

<pre class="ex-mapping nohighlight"><!-- nohighlight because otherwise the bolding is lost and we don't use highlighting anyway-->
# logical source that will iterate over the CSV file
:CSVLogicalSource a rml:LogicalSource ;
  rml:source :CSVFile ;
  rml:referenceFormulation ql:CSV .

# triples map that generates "type" triples
:innerTriplesMap a rr:TriplesMap ;
  rml:logicalSource :CSVLogicalSource ;
  rr:subjectMap [ rr:template "http://example.com/{entity}" ] ;
  rr:predicateObjectMap [
    rr:predicate rdf:type ;
    rr:objectMap [ rr:template "http://example.com/{class}" ] ] .
    
# triples map that generates "confidence" triples
:outerTriplesMap a rr:TriplesMap ;
  rml:logicalSource :CSVLogicalSource ;
  rr:subjectMap [ <b>rml:embeddedTriplesMap :innerTriplesMap</b> ] ;
  rr:predicateObjectMap [
    rr:predicate :confidence ;
    rr:objectMap [ 
      rml:reference "confidence" ;
      rr:termType xsd:float ] ] .
</pre>

<pre class="ex-output">
# Triples generated by :innerTriplesMap
:Alice a :Person .
:Bobby a :Dog .

# Triples generated by :outerTriplesMap
<< :Alice a :Person >> :confidence 0.8 .
<< :Bobby a :Dog >> :confidence 0.6 .
</pre>

By default, triples generated by a triples map are generated as [=asserted triples=].
If the triples map is also used in a [=star map=], the triples it generates *also* occur in the resulting graph as [=embedded triples=], by the process explained in the previous paragraph.
The generation of asserted triples by a triples map can be supressed by declaring it an <dfn>non-asserted triples map</dfn> (`rml:NonAssertedTriplesMap`),
a subclass of `rr:TriplesMap`.
A triples map of subclass [=non-asserted triples map=] does not generate [=asserted triples=],
but might generate [=embedded triples=] if it is used in a [=star map=].
A summary of how to generate triples in any combination of [=asserted=] and/or [=embedded=] is given in the following table, where `rr:TriplesMap` refers to instances of `rr:TriplesMap` that are not of the `rml:NonAssertedTriplesMap` subclass:

<nop>| Embedded | Not embedded
-|-|-
**Asserted**| `rr:TriplesMap` *with* `rml:StarMap`| `rr:TriplesMap` *without* `rml:StarMap`
**Not asserted**| `rml:NonAssertedTriplesMap` *with* `rml:StarMap`|  `rml:NonAssertedTriplesMap` *without* `rml:StarMap`


The following example is different than the previous in that `:innerTriplesMap` is declared to be an instance of `rml:NonAssertedTriplesMap`, with the effect that the generated "type" triples are only present in the resulting graph as [=embedded triples=], not as [=asserted triples=]:

<pre class="ex-input">
entity,class,confidence
Alice,Person,0.8
Bobby,Dog,0.6
</pre>

<pre class="ex-mapping nohighlight"><!-- nohighlight because otherwise the bolding is lost and we don't use highlighting anyway-->
# logical source that will iterate over the CSV file
:CSVLogicalSource a rml:LogicalSource ;
  rml:source :CSVFile ;
  rml:referenceFormulation ql:CSV .

# triples map that generates "type" triples
:innerTriplesMap <b>a rml:NonAssertedTriplesMap</b> ;
  rml:logicalSource :CSVLogicalSource ;
  rr:subjectMap [ rr:template "http://example.com/{entity}" ] ;
  rr:predicateObjectMap [
    rr:predicate rdf:type ;
    rr:objectMap [ rr:template "http://example.com/{class}" ] ] .
    
# triples map that generates "confidence" triples
:outerTriplesMap a rr:TriplesMap ;
  rml:logicalSource :CSVLogicalSource ;
  rr:subjectMap [ rml:embeddedTriplesMap :innerTriplesMap ] ;
  rr:predicateObjectMap [
    rr:predicate :confidence ;
    rr:objectMap [ 
      rml:reference "confidence" ;
      rr:termType xsd:float ] ] .
</pre>

<pre class="ex-output">
<< :Alice a :Person >> :confidence 0.8 .
<< :Bobby a :Dog >> :confidence 0.6 .
</pre>